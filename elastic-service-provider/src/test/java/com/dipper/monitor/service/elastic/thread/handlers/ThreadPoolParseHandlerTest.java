package com.dipper.monitor.service.elastic.thread.handlers;

import com.dipper.monitor.entity.db.elastic.ThreadMetricEntity;
import org.junit.Test;

import java.util.List;

import static org.junit.Assert.*;

public class ThreadPoolParseHandlerTest {

    @Test
    public void parseThreadPoolResponse() {
        String response = "{\"_nodes\":{\"total\":4,\"successful\":4,\"failed\":0},\"cluster_name\":\"es_1.server1\",\"nodes\":{\"tEq2FE4oTwmBptZ5FYQm8w\":{\"timestamp\":1748092023091,\"name\":\"1.es3\",\"transport_address\":\"78.118.1.34:9300\",\"host\":\"78.118.1.34\",\"ip\":\"78.118.1.34:9300\",\"roles\":[\"data\",\"data_cold\",\"data_content\",\"data_frozen\",\"data_hot\",\"data_warm\",\"ingest\",\"master\",\"remote_cluster_client\",\"transform\"],\"attributes\":{\"xpack.installed\":\"true\",\"transform.node\":\"true\"},\"thread_pool\":{\"analyze\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"auto_complete\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"ccr\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"fetch_shard_started\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":8,\"completed\":37},\"fetch_shard_store\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":4,\"completed\":26},\"flush\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":93682625},\"force_merge\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"generic\":{\"threads\":10,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":10,\"completed\":25644714},\"get\":{\"threads\":48,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":48,\"completed\":237587},\"listener\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"management\":{\"threads\":5,\"queue\":0,\"active\":1,\"rejected\":0,\"largest\":5,\"completed\":64212801},\"refresh\":{\"threads\":10,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":10,\"completed\":82809108},\"rollup_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"search\":{\"threads\":73,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":73,\"completed\":4139935},\"search_coordination\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":991900},\"search_throttled\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":1,\"completed\":1},\"searchable_snapshots_cache_fetch_async\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"searchable_snapshots_cache_prewarming\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot_meta\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_read\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_write\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_read\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":5904039},\"system_write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":5278111},\"transform_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"vector_tile_generation\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"warmer\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":34589358},\"write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":2166093}}},\"UyTW8SeuQSeLWC8eZ9ISDg\":{\"timestamp\":1748092023091,\"name\":\"1.es1\",\"transport_address\":\"78.118.1.36:9300\",\"host\":\"78.118.1.36\",\"ip\":\"78.118.1.36:9300\",\"roles\":[\"data\",\"data_cold\",\"data_content\",\"data_frozen\",\"data_hot\",\"data_warm\",\"ingest\",\"master\",\"remote_cluster_client\",\"transform\"],\"attributes\":{\"xpack.installed\":\"true\",\"transform.node\":\"true\"},\"thread_pool\":{\"analyze\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"auto_complete\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"ccr\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"fetch_shard_started\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":37},\"fetch_shard_store\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":4,\"completed\":26},\"flush\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":94830829},\"force_merge\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"generic\":{\"threads\":14,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":14,\"completed\":29048934},\"get\":{\"threads\":48,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":48,\"completed\":88819},\"listener\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"management\":{\"threads\":5,\"queue\":0,\"active\":1,\"rejected\":0,\"largest\":5,\"completed\":79729532},\"refresh\":{\"threads\":10,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":10,\"completed\":76478704},\"rollup_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"search\":{\"threads\":73,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":73,\"completed\":5211294},\"search_coordination\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":552801},\"search_throttled\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":1,\"completed\":1},\"searchable_snapshots_cache_fetch_async\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"searchable_snapshots_cache_prewarming\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot_meta\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_read\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_write\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_read\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":3669516},\"system_write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":2705291},\"transform_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"vector_tile_generation\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"warmer\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":21084395},\"write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":3126041}}},\"RetwUSTLTqGGFMygt4FeIw\":{\"timestamp\":1748092023091,\"name\":\"1.es2\",\"transport_address\":\"78.118.1.35:9300\",\"host\":\"78.118.1.35\",\"ip\":\"78.118.1.35:9300\",\"roles\":[\"data\",\"data_cold\",\"data_content\",\"data_frozen\",\"data_hot\",\"data_warm\",\"ingest\",\"master\",\"remote_cluster_client\",\"transform\"],\"attributes\":{\"xpack.installed\":\"true\",\"transform.node\":\"true\"},\"thread_pool\":{\"analyze\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"auto_complete\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"ccr\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"fetch_shard_started\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":4,\"completed\":37},\"fetch_shard_store\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":4,\"completed\":26},\"flush\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":94729969},\"force_merge\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"generic\":{\"threads\":12,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":12,\"completed\":24959423},\"get\":{\"threads\":48,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":48,\"completed\":306782},\"listener\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"management\":{\"threads\":5,\"queue\":0,\"active\":1,\"rejected\":0,\"largest\":5,\"completed\":61363419},\"refresh\":{\"threads\":10,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":10,\"completed\":73411640},\"rollup_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"search\":{\"threads\":73,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":73,\"completed\":2678194},\"search_coordination\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":475993},\"search_throttled\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":1,\"completed\":1},\"searchable_snapshots_cache_fetch_async\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"searchable_snapshots_cache_prewarming\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot_meta\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_read\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_write\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_read\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":4576805},\"system_write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":2582885},\"transform_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"vector_tile_generation\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"warmer\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":16854768},\"write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":1837751}}},\"Y-UPghuXQvudPy6Dl7JbOg\":{\"timestamp\":1748092023091,\"name\":\"1.es4\",\"transport_address\":\"78.118.1.33:9300\",\"host\":\"78.118.1.33\",\"ip\":\"78.118.1.33:9300\",\"roles\":[\"data\",\"data_cold\",\"data_content\",\"data_frozen\",\"data_hot\",\"data_warm\",\"ingest\",\"master\",\"remote_cluster_client\",\"transform\"],\"attributes\":{\"xpack.installed\":\"true\",\"transform.node\":\"true\"},\"thread_pool\":{\"analyze\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"auto_complete\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"ccr\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"fetch_shard_started\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":4,\"completed\":37},\"fetch_shard_store\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":3,\"completed\":26},\"flush\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":93580868},\"force_merge\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"generic\":{\"threads\":11,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":11,\"completed\":24931917},\"get\":{\"threads\":48,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":48,\"completed\":455941},\"listener\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"management\":{\"threads\":5,\"queue\":0,\"active\":1,\"rejected\":0,\"largest\":5,\"completed\":58354221},\"refresh\":{\"threads\":10,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":10,\"completed\":78059373},\"rollup_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"search\":{\"threads\":73,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":73,\"completed\":3227341},\"search_coordination\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":308268},\"search_throttled\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":1,\"completed\":1},\"searchable_snapshots_cache_fetch_async\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"searchable_snapshots_cache_prewarming\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"snapshot_meta\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_read\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_critical_write\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"system_read\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":1593475},\"system_write\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"transform_indexing\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"vector_tile_generation\":{\"threads\":0,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":0,\"completed\":0},\"warmer\":{\"threads\":1,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":657491},\"write\":{\"threads\":5,\"queue\":0,\"active\":0,\"rejected\":0,\"largest\":5,\"completed\":1509775}}}}}";
        ThreadPoolParseHandler threadPoolParseHandler = new ThreadPoolParseHandler();
        List<ThreadMetricEntity> result = threadPoolParseHandler.parseThreadPoolResponse(response, "test");
        System.out.println(result);
    }
}